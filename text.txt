import jieba

#text = "马上就要中考了，我真的太紧张了，每天就在想考砸了怎么办？"
#words = list(jieba.cut(text, cut_all=False))
#print(words)
# ['中华民族', '创造', '了', '悠久', '灿烂', '的', '中华文明', '，', '为', '人类', '作出', '了', '卓越贡献', '。']


def loadDict(fileName, score):
    wordDict = {}
    with open(fileName, encoding='utf-8') as fin:
        for line in fin:
            word = line.strip()
            wordDict[word] = score
    return wordDict


def appendDict(wordDict, fileName, score):
    with open(fileName) as fin:
        for line in fin:
            word = line.strip()
            wordDict[word] = score


def loadExtentDict(fileName, level):
    extentDict = {}
    for i in range(level):
        with open(fileName + str(i + 1) + ".txt", encoding='utf-8') as fin:
            for line in fin:
                word = line.strip()
                extentDict[word] = i + 1
    return extentDict


import jieba



def getScore(content):
    postDict = loadDict(u"D:/日常办公/支撑性工作/智慧心育/数据探索/线上回流数据/情感词典/正面情感词语（中文）.txt", 1)  # 积极情感词典
    negDict = loadDict(u"D:/日常办公/支撑性工作/智慧心育/数据探索/线上回流数据/情感词典/负面情感词语（中文）.txt", -1)  # 消极情感词典
    inverseDict = loadDict(u"D:/日常办公/支撑性工作/智慧心育/数据探索/线上回流数据/情感词典/否定词语.txt", -1)  # 否定词词典
    extentDict = loadExtentDict(u"D:/日常办公/支撑性工作/智慧心育/数据探索/线上回流数据/情感词典/程度级别词语（中文）", 6)
    punc = loadDict(u"D:/日常办公/支撑性工作/智慧心育/数据探索/线上回流数据/情感词典/标点符号.txt", 1)
    exclamation = {"!": 2, "！": 2}

    words = jieba.cut(content)
    wordList = list(words)
    # print(wordList)

    totalScore = 0  # 记录最终情感得分
    lastWordPos = 0  # 记录情感词的位置
    lastPuncPos = 0  # 记录标点符号的位置
    i = 0  # 记录扫描到的词的位置

    for word in wordList:
        if word in punc:
            lastPuncPos = i

        if word in postDict:
            if lastWordPos > lastPuncPos:
                start = lastWordPos
            else:
                start = lastPuncPos

            score = 1
            for word_before in wordList[start:i]:
                if word_before in extentDict:
                    score = score * extentDict[word_before]
                if word_before in inverseDict:
                    score = score * -1
            for word_after in wordList[i + 1:]:
                if word_after in punc:
                    if word_after in exclamation:
                        score = score + 2
                    else:
                        break
            lastWordPos = i
            totalScore += score
        elif word in negDict:
            if lastWordPos > lastPuncPos:
                start = lastWordPos
            else:
                start = lastPuncPos
            score = -1
            for word_before in wordList[start:i]:
                if word_before in extentDict:
                    score = score * extentDict[word_before]
                if word_before in inverseDict:
                    score = score * -1
            for word_after in wordList[i + 1:]:
                if word_after in punc:
                    if word_after in exclamation:
                        score = score - 2
                    else:
                        break
            lastWordPos = i
            totalScore += score
        i = i + 1

    return totalScore

content = u"你真的是一个非常好的人!"
print(getScore(content))  # 11


